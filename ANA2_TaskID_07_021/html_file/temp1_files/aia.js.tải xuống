(function() {
  function cgbk(ke) {
    var re = null;
    if (navigator.cookieEnabled && document.cookie) {
      var co = document.cookie.split(';');
      for (var ci = 0; ci < co.length; ci++) {
        var str = co[ci].split('=');
        if (str[0].replace(/^\s+|\s+$/g,'') == ke) {
          re = str[1];
          break;
        }
      }
    }
    return re;
  }
  function cpbk(k, v, e, d, p) {
    if (navigator.cookieEnabled) {
      var s = null;
      if (k && v) {
        s = k + '=' + v + ';';
        if (e) {
          var ex = new Date();
          ex.setTime(ex.getTime() + e * 1000);
          s += 'expires=' + ex.toUTCString() + ';';
        }
        if (d) {
          s += 'domain=' + d + ';';
        }
        if (p) {
          s += 'path=' + p + ';';
        }
        document.cookie = s;
      }
    }
  }
  (function(a) {
    var cd = null;
    var cs = '';
    var r = document.referrer;
    if ((typeof _aiaq != 'undefined')  && (_aiaq instanceof Array)) {
      for (var qidx = 0; qidx < _aiaq.length; qidx++) {
        var cv = _aiaq[qidx];
        if (cv instanceof Array) {
          if (cv[0] == '_setDomainName') {
            cd = cv[1];
            continue;
          } else if (cv[0] == '_photo_ref') {
            r = cv[1];
            continue;
          }
          cs += '&' + encodeURIComponent(cv[0]) + '=';
          if (cv.length > 1) {
            cv.shift();
            cs += encodeURIComponent(cv.join(','));
          }
        }
      }
    }
    var h = ('https:' == a.dl.protocol ? 'https://' : 'http://') + a.dl.host;
    var p = a.dl.pathname;
    var q = a.dl.search || '';
    p += q;
    var u = cgbk('_aiau');
    if (u == null) {
      u = (Math.round(Math.random()*100000000).toString() + (new Date()).getTime()).toString();
      cpbk('_aiau', u, 63072000, cd, '/');
    }
    var a = ('https:' == a.dl.protocol ? 'https://' : 'http://') + 's3-ap-northeast-1.amazonaws.com/ai-img/1x1.gif?ts=' + (new Date()).getTime() +
        '&h=' + encodeURIComponent(h) + '&p=' + encodeURIComponent(p) + '&r=' + encodeURIComponent(r) + '&u=' + u + cs;

    img = new Image(1, 1);
    img.src = a
  })(new function() {
    this.dl = document.location;
  })
})();